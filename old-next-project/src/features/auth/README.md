# Модуль аутентификации и авторизации

## Структура
```
auth/
  ├── api/                      # API хуки
  │   ├── use-current.ts        # Получение данных текущего пользователя
  │   ├── use-login.ts         # Вход в систему
  │   ├── use-logout.ts        # Выход из системы
  │   └── use-register.ts      # Регистрация
  ├── components/              # Компоненты
  │   ├── role-guard.tsx       # Защита компонентов по ролям
  │   ├── with-role-guard.tsx  # HOC для защиты страниц
  │   ├── sign-in-card.tsx    # Форма входа
  │   ├── sign-up-card.tsx    # Форма регистрации
  │   └── user-button.tsx     # Кнопка пользователя
  ├── hooks/                  # Хуки
  │   └── use-auth.ts         # Основной хук для работы с авторизацией
  ├── constants.ts           # Константы (роли и разрешения)
  ├── queries.ts            # Серверные запросы
  └── schemas.ts           # Схемы валидации
```

## Основные компоненты

### useAuth
Централизованный хук для работы с авторизацией:
```typescript
const { 
  user,                    // Данные пользователя
  roles,                   // Роли пользователя
  permissions,            // Разрешения пользователя
  hasRole,               // Проверка роли
  hasPermission,        // Проверка разрешения
  isLoading,           // Статус загрузки
  isAuthenticated,    // Статус аутентификации
  // Вспомогательные геттеры
  isAdmin,
  isProjectOwner,
  isPowerUser,
  isProjectMember,
  // Разрешения администратора
  canManageProjectOwners,
  canManageUsers,
  // ... и другие
} = useAuth();
```

### RoleGuard
Компонент для защиты частей интерфейса:
```typescript
<RoleGuard 
  roles={[ROLES.ADMIN]} 
  permissions={["manage_users"]}
>
  <ProtectedComponent />
</RoleGuard>
```

### withRoleGuard
HOC для защиты целых страниц:
```typescript
export default withRoleGuard(AdminPage, {
  roles: ROLES.ADMIN,
  redirectTo: '/'
});
```

## Кэширование и оптимизация

### useCurrent
- Кэширование данных пользователя на 10 минут
- Отключено обновление при фокусе окна
- Используется во всех компонентах через `useAuth`

### QueryClient настройки
```typescript
{
  queries: {
    staleTime: 5 * 60 * 1000,  // Данные считаются свежими 5 минут
    gcTime: 10 * 60 * 1000,    // Удаление из кэша через 10 минут
    refetchOnWindowFocus: false,// Нет автообновления при фокусе
    refetchOnReconnect: false, // Нет автообновления при реконнекте
    retry: 1,                 // Одна повторная попытка при ошибке
  }
}
```

## Роли и разрешения

### Роли
- `ADMIN` - Администратор системы
- `PROJECT_OWNER` - Руководитель проекта
- `PROJECT_MEMBER` - Участник проекта
- `POWER_USER` - Участник с расширенными правами

### Разрешения
Каждая роль имеет свой набор разрешений:
- Администратор: управление пользователями, просмотр проектов
- Руководитель: управление проектом и участниками
- Участник: базовые действия в проекте
- Power User: базовые действия + управление спринтами

## Безопасность
- Проверка прав на клиенте и сервере
- Кэширование для оптимизации производительности
- Защита роутов от несанкционированного доступа
- Редирект на главную при отсутствии прав 